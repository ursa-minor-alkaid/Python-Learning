# 元类

时间：`2025年11月1日`

## 1. 基本介绍

- 在 python 中，一切都是对象
  - 当创建一个 list 对象时，需要用到 list类；某个具体的 list 对象是 list类的一个实例
  - 而创建 list实例的 list类也是一个对象，这个对象也是被某个东西创建出来的；而创建类对象的东西，就是**元类（metaclass）**
- 因此，python 的类本身是类的同时，又是元类的一个实例
- 在Python中，所有类的默认元类是 `type`。即用来检查对象类型的 `type()` 函数
  - **避免“无穷倒退”**：`type` 的类型就是它自己

    ```python
    print(type(type))
    # 输出结果：<class 'type'>
    ```

  - 所以，使用 `type()` 函数可以创建类（见下）
- 元类的核心作用：拦截并控制类的创建过程（见下[自定义元类](#3-自定义元类))

---

## 2. `type()`

**`type()` 函数用于查看对象类型**

- `type(some_object)` 的核心原理是返回创建 `some_object` 这个对象的类，即返回该对象作为实例所属的类
- 例如，某个 list 对象是由 list类创建的，因此 `print(type(list))` 返回的就是 `list`
- 因此，当检查某个类的类型时，返回的就是 `type`，因为类是由元类 type 创建的

    ```python
    class Hello():
        pass

    print(type(Hello))
    # 输出结果是 type
    ```

**`type()` 函数用于创建新的类型**

- 语法格式：`type(类名, 继承的父类集合, 包含属性的字典（名称和值）)`
  - 继承的父类集合：一个包含所有父类（基类）的元组。如果类没有父类（即继承自 `object`），你需要传入一个只包含 `object` 的元组 `(object,)`。注意，即使只有一个父类，也必须是元组形式
  - 包含属性的字典：
    - 字典的键是属性或方法的名字
    - 字典的值是属性的值或者函数对象
  - 示例：

    ```python
    MyClass_dynamic = type(
        'MyClass',  # 1. 类的名字
        (object,),  # 2. 父类的元组 (继承自 object)
        {           # 3. 属性和方法的字典
            'x': 10,
            'greet': greet_func
        }
    )

    # 直接用 dict 函数
    Hello = type(
        'Hello', 
        (object,), 
        dict(hello=printHello)
    )
    ```

<mark>↑ 跨行括号的格式问题，及其与json语法格式的关系</mark>

- **`type()` 和 `class` 创建类的区别**：
  - 几乎相同，**日常编程使用 `class`**
  - `class` 是静态的、声明式的，灵活性较低
  - `type()`：是动态的、命令式的，灵活性较高

---

## 3. 自定义元类及其作用

- 自定义元类允许开发者在类对象被创建时进行拦截、检查和修改
- 元类主要用于框架和库的设计
  - **黄金法则: “如果你不确定是否需要元类，那么你就不需要它。”**
  - > “元类就是深度的魔法，99% 的用户应该根本不必为此操心。如果你想搞清楚究竟是否需要用到元类，那么你就不需要它。那些实际用到元类的人都非常清楚地知道他们需要做什么，而且根本不需要解释为什么要用元类。”